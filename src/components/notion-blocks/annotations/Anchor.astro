---
import { REFERENCES } from "@/constants";
import { getAnchorLinkAndBlock } from "../../../lib/blog-helpers.ts";
import { RichText } from "../../../lib/interfaces.ts";
import NPagePopover from "@/components/blog/references/NPagePopover.astro";
import NBlocksPopover from "@/components/blog/references/NBlocksPopover.astro";

export interface Props {
	richText: RichText;
	blockID?: string;
}

const { richText, blockID } = Astro.props;
const {hreflink, blocklinked, conditionmatch, post} = await getAnchorLinkAndBlock(richText,blockID);
---

{
  hreflink && REFERENCES && REFERENCES["popovers"] && conditionmatch && ["block_current_page", "block_other_page", "other_page"].includes(conditionmatch) && post && post.Title ? (
    conditionmatch === "block_current_page" || conditionmatch === "block_other_page" ? (
      <NBlocksPopover block={blocklinked} linkedTo={hreflink} popoverSpanText={""} popoverTitle={post.Title}><slot /></NBlocksPopover>
    ) : (
      <NPagePopover linkedTo={hreflink} popoverSpanText={""} popoverTitle={post.Title} postId={post.PageId} excerpt={post.Excerpt}><slot /></NPagePopover>
    )
  ) : hreflink ? (
    <a href={hreflink} class="text-link underline decoration-accent-2 hover:decoration-accent underline-offset-4">
      <slot />
    </a>
  ) : (
    <slot />
  )
}
