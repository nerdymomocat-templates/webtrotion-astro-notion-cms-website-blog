---
import { ENABLE_LIGHTBOX } from "../../../constants.ts";
import * as interfaces from "../../../lib/interfaces.ts";
import { filePath } from "../../../lib/blog-helpers";
import Caption from "../Caption.astro";

export interface Props {
	block: interfaces.Block;
}

const { block } = Astro.props;

let image = "";
if (block.NImage?.External) {
	image = block.NImage.External.Url;
} else if (block.NImage?.File) {
	image = filePath(new URL(block.NImage.File.OptimizedUrl));
}
---

<figure class="flex mx-auto mt-1">
  {
      image && (
          <div class="mx-auto">
              <div>
                  {ENABLE_LIGHTBOX ? (
                      <a data-fslightbox href={image} data-type="image">
                          <img class="block max-w-full" src={image} alt={block.NImage?.Caption.map((richText) => richText.PlainText).join(' ')} />
                      </a>
                  ) : (
                      <img class="block max-w-full" src={image} alt={block.NImage?.Caption.map((richText) => richText.PlainText).join(' ')} />
                  )}
              </div>
              <Caption richTexts={block.NImage.Caption} block={block} />
          </div>
      )
  }
</figure>
